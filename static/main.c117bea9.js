(()=>{"use strict";var t={817:(t,e,i)=>{i.r(e)},504:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Action=void 0,function(t){t[t.MoveForward=0]="MoveForward",t[t.MoveLeft=1]="MoveLeft",t[t.MoveRight=2]="MoveRight"}(e.Action||(e.Action={}))},810:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Direction=void 0,function(t){t[t.Up=0]="Up",t[t.Right=1]="Right",t[t.Down=2]="Down",t[t.Left=3]="Left"}(e.Direction||(e.Direction={}))},487:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Grid=void 0;var r=i(567),o=i(586),n=i(302),a=i(908),s=i(504),c=i(177),h=[];h[a.Tile.Empty]=0,h[a.Tile.Wall]=-1,h[a.Tile.Food]=1;var d=[];d[a.Tile.Empty]="#001328",d[a.Tile.Wall]="#feb3bf",d[a.Tile.Food]="#880e24";var l=["#92e790","#eafffb","#54ffdb","#fc2f25","#f92dc7","#d0f392","#b5f458","#e2f73a","#5ec0ff","#ffecaf","#efe5d2","#eff5a7","#4fe946","#9ddcff","#66a37c","#afebc6","#fed07d","#5aeb88","#ffd143","#38bc5e"],f=function(){function t(t){this.width=t.width,this.height=t.height,this.tileSize=t.tileSize,this.wyrms={},this.nextWyrmId=a.Tile.Wyrm,this.stepCount=0,this.tiles=new Uint8Array(this.width*this.height),this.fill(),this.canvasElement=t.canvasElement,this.context=(0,r.getRenderingContext)(this.canvasElement),this.setCanvasSize()}return t.prototype.setCanvasSize=function(){var t=this.width*this.tileSize,e=this.height*this.tileSize;this.canvasElement.width=t*this.renderScale,this.canvasElement.height=e*this.renderScale,this.canvasElement.style.width="".concat(t,"px"),this.canvasElement.style.height="".concat(e,"px")},t.prototype.fill=function(){for(var t=0;t<this.height;t++)for(var e=0;e<this.width;e++){var i={x:e,y:t},o=this.atEdge(i)?a.Tile.Wall:(0,r.randomChance)(1/16)?a.Tile.Food:a.Tile.Empty;this.setTile(i,o)}},t.prototype.step=function(){var t=this;this.stepCount>32&&this.stepCount%64==0&&this.createRandomWyrm();var e=Object.keys(this.wyrms).map((function(e){return t.wyrms[+e]}));e.sort((function(t){return-t.size})),e.forEach((function(e){t.wyrms[e.id]&&e.doBestAction()})),this.stepCount++},t.prototype.draw=function(){for(var t=0;t<this.width;t++)for(var e=0;e<this.height;e++){var i={x:t,y:e},r=this.getTile(i),o=this.getTileColor(r),n=this.tileSize*this.renderScale;this.context.fillStyle=o,this.context.fillRect(t*n,e*n,n,n)}},t.prototype.getTileColor=function(t){var e=t;return e<a.Tile.Wyrm?d[e]:(e=(e-a.Tile.Wyrm)%l.length,l[e])},t.prototype.getTileScore=function(t){var e=h[t];return void 0!==e?e:-1},t.prototype.createRandomWyrm=function(){var t={x:Math.floor(this.width/2),y:Math.floor(this.height/2)},e=(0,r.randomInt)(0,3);this.createWyrm(t,e)},t.prototype.createWyrm=function(t,e){var i=this.getTile(t);if(!(i===a.Tile.Wall||i>=a.Tile.Wyrm)){var r=this.nextWyrmId++,o=new c.Wyrm({id:r,position:t,direction:e,grid:this});this.wyrms[r]=o,this.setTile(t,r)}},t.prototype.destroyWyrm=function(t){var e=this,i=this.wyrms[t];delete this.wyrms[t],i.segments.forEach((function(t){var i=(0,r.randomChance)(1/4)?a.Tile.Empty:a.Tile.Food;e.setTile(t,i)}))},t.prototype.fightWyrms=function(t,e){var i=this.wyrms[t],o=this.wyrms[e],n=i,a=o;i.size/o.size*((0,r.randomInt)(8,12)/10)<.5&&(n=o,a=i),a.die(),n.doAction(s.Action.MoveForward)},t.prototype.getTile=function(t){var e=this.index(t);return this.tiles[e]},t.prototype.getNeighbors=function(t,e){var i=(0,r.rotateDirection)(e,n.RelativeDirection.Left),a=(0,r.rotateDirection)(e,n.RelativeDirection.Right),s=(0,o.moveInDirection)(t,e),c=(0,o.moveInDirection)(t,i),h=(0,o.moveInDirection)(t,a);return[[n.RelativeDirection.Forward,this.getTile(s)],[n.RelativeDirection.Left,this.getTile(c)],[n.RelativeDirection.Right,this.getTile(h)]]},t.prototype.setTile=function(t,e){var i=this.index(t);this.tiles[i]=e},t.prototype.atEdge=function(t){var e=t.x,i=t.y;return 0===i||i===this.height-1||0===e||e===this.width-1},t.prototype.index=function(t){return t.y*this.width+t.x},Object.defineProperty(t.prototype,"renderScale",{get:function(){return window.devicePixelRatio},enumerable:!1,configurable:!0}),t}();e.Grid=f},586:function(t,e,i){var r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,i=1,r=arguments.length;i<r;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.wrapBounds=e.moveInDirection=void 0;var o=i(810);e.moveInDirection=function(t,e){var i=r({},t);switch(e){case o.Direction.Up:i.y-=1;break;case o.Direction.Right:i.x+=1;break;case o.Direction.Down:i.y+=1;break;case o.Direction.Left:i.x-=1}return i},e.wrapBounds=function(t,e,i){return{x:(t.x+e)%e,y:(t.y+i)%i}}},302:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.RelativeDirection=void 0,function(t){t[t.Forward=0]="Forward",t[t.Right=1]="Right",t[t.Backward=2]="Backward",t[t.Left=3]="Left"}(e.RelativeDirection||(e.RelativeDirection={}))},908:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Tile=void 0,function(t){t[t.Empty=0]="Empty",t[t.Wall=1]="Wall",t[t.Food=2]="Food",t[t.Wyrm=3]="Wyrm"}(e.Tile||(e.Tile={}))},177:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Wyrm=void 0;var r=i(586),o=i(908),n=i(567),a=function(){function t(t){this.id=t.id,this.grid=t.grid,this.segments=[t.position],this.direction=t.direction}return Object.defineProperty(t.prototype,"size",{get:function(){return this.segments.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"head",{get:function(){return this.segments[0]},enumerable:!1,configurable:!0}),t.prototype.doBestAction=function(){var t=this.grid.getNeighbors(this.head,this.direction),e=this.selectBestDirection(t),i=(0,n.actionFromRelativeDirection)(e);this.doAction(i)},t.prototype.selectBestDirection=function(t){var e=this,i=t.map((function(t){var i=t[0],r=t[1];return[i,e.grid.getTileScore(r)]})).sort((function(t,e){var i=t[1];return e[1]-i}));return i[0][0]},t.prototype.doAction=function(t){var e=(0,n.relativeDirectionFromAction)(t),i=(0,n.rotateDirection)(this.direction,e),a=(0,r.moveInDirection)(this.head,i),s=this.grid.getTile(a);switch(s){case o.Tile.Wall:case this.id:return this.die();case o.Tile.Empty:return this.move({direction:i,grow:!1,poop:(0,n.randomChance)(1/32)});case o.Tile.Food:return this.move({direction:i,grow:!0,poop:!1});default:return this.grid.wyrms[s]?this.grid.fightWyrms(this.id,s):(console.warn("enemy wyrm #".concat(s," is dead")),void this.grid.setTile(a,o.Tile.Empty))}},t.prototype.move=function(t){var e=t.direction,i=t.grow,n=t.poop,a=(0,r.moveInDirection)(this.head,e);if(this.grid.setTile(a,this.id),this.segments.unshift(a),!i){var s=this.segments.pop()||a,c=n?o.Tile.Food:o.Tile.Empty;this.grid.setTile(s,c)}this.direction=e},t.prototype.die=function(){this.grid.destroyWyrm(this.id)},t}();e.Wyrm=a},992:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.App=void 0;var r=i(567),o=i(487),n=function(){function t(t){var e=Math.floor(window.innerWidth/8),i=Math.floor(window.innerHeight/8);t.addEventListener("click",this.onClick.bind(this)),this.grid=new o.Grid({width:e,height:i,tileSize:8,canvasElement:t}),this.lastStepTime=0,this.stepInterval=62.5,this.run()}return t.prototype.run=function(){var t=this,e=function(i){requestAnimationFrame(e),i>=t.lastStepTime+t.stepInterval&&(t.lastStepTime=i,t.grid.step(),t.grid.draw())};requestAnimationFrame(e)},t.prototype.onClick=function(t){var e={x:Math.floor(t.offsetX/this.grid.tileSize),y:Math.floor(t.offsetY/this.grid.tileSize)},i=(0,r.randomInt)(0,3);this.grid.createWyrm(e,i),this.grid.step()},t}();e.App=n},567:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.rotateDirection=e.relativeDirectionFromAction=e.randomInt=e.randomChance=e.getRenderingContext=e.actionFromRelativeDirection=void 0;var r=i(302),o=i(504);e.actionFromRelativeDirection=function(t){switch(t){case r.RelativeDirection.Forward:return o.Action.MoveForward;case r.RelativeDirection.Left:return o.Action.MoveLeft;default:return o.Action.MoveRight}},e.getRenderingContext=function(t){var e=t.getContext("2d");if(null===e)throw new Error("Can't initialize rendering context");return e},e.randomChance=function(t){return Math.random()<t},e.randomInt=function(t,e){var i=e-t+2;return Math.floor(Math.random()*i)+t},e.relativeDirectionFromAction=function(t){switch(t){case o.Action.MoveForward:return r.RelativeDirection.Forward;case o.Action.MoveLeft:return r.RelativeDirection.Left;case o.Action.MoveRight:return r.RelativeDirection.Right}},e.rotateDirection=function(t,e){return(t+e+4)%4}}},e={};function i(r){var o=e[r];if(void 0!==o)return o.exports;var n=e[r]={exports:{}};return t[r].call(n.exports,n,n.exports,i),n.exports}i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r;r=i(992),i(817),document.addEventListener("DOMContentLoaded",(function(t){var e=document.createElement("canvas");document.body.appendChild(e),new r.App(e)}))})();
//# sourceMappingURL=main.c117bea9.js.map